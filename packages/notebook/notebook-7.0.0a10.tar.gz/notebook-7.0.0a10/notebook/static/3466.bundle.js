"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[3466],{83466:(e,t,n)=>{n.r(t),n.d(t,{RunningLanguageServer:()=>b,default:()=>_});var r=n(34215),a=n(61795),s=n(79657),o=n(82589),i=n(52086),c=n(7191),l=n(76103),m=n(31969),u=n(72245),d=n.n(u);const p="languageServers",h="configuration";function g(e){const{[h]:t,...n}=e.schema,{[h]:r,serverName:a,...s}=e.settings,[o,i]=(0,u.useState)(a),c={};Object.entries(r).forEach((([e,t])=>{const n={property:e,type:typeof t,value:t};c[l.UUID.uuid4()]=n}));const[p,g]=(0,u.useState)(c),f={};Object.entries(n).forEach((([e,t])=>{f[e]=e in s?s[e]:t.default}));const[E,y]=(0,u.useState)(f),S=t=>{const n={};Object.entries(p).forEach((([r,a])=>{r!==t&&(n[r]=a);const s={};Object.values(n).forEach((e=>{s[e.property]=e.value})),e.updateSetting.invoke(e.serverHash,{[h]:s}).catch(console.error),g(n)}))},b=new m.Debouncer(((t,n)=>{if(t in p){const r={...p,[t]:n},a={};Object.values(r).forEach((e=>{a[e.property]=e.value})),g(r),e.updateSetting.invoke(e.serverHash,{[h]:a}).catch(console.error)}}));return d().createElement("div",{className:"array-item"},d().createElement("div",{className:"form-group "},d().createElement("div",{className:"jp-FormGroup-content"},d().createElement("div",{className:"jp-objectFieldWrapper"},d().createElement("fieldset",null,d().createElement("div",{className:"form-group small-field"},d().createElement("div",{className:"jp-modifiedIndicator jp-errorIndicator"}),d().createElement("div",{className:"jp-FormGroup-content"},d().createElement("h3",{className:"jp-FormGroup-fieldLabel jp-FormGroup-contentItem"},e.trans.__("Server name:")),d().createElement("div",{className:"jp-inputFieldWrapper jp-FormGroup-contentItem"},d().createElement("input",{className:"form-control",type:"text",required:!0,value:o,onChange:t=>{(t=>{e.updateSetting.invoke(e.serverHash,{serverName:t.target.value}).catch(console.error),i(t.target.value)})(t)}})),d().createElement("div",{className:"validationErrors"},d().createElement("div",null,d().createElement("ul",{className:"error-detail bs-callout bs-callout-info"},d().createElement("li",{className:"text-danger"},e.trans.__("is a required property"))))))),Object.entries(n).map((([t,n],r)=>d().createElement("div",{key:`${r}-${t}`,className:"form-group small-field"},d().createElement("div",{className:"jp-FormGroup-content"},d().createElement("h3",{className:"jp-FormGroup-fieldLabel jp-FormGroup-contentItem"},n.title),d().createElement("div",{className:"jp-inputFieldWrapper jp-FormGroup-contentItem"},d().createElement("input",{className:"form-control",placeholder:"",type:n.type,value:E[t],onChange:r=>((t,n,r)=>{let a=n;"number"===r&&(a=parseFloat(n));const s={...E,[t]:a};e.updateSetting.invoke(e.serverHash,s).catch(console.error),y(s)})(t,r.target.value,n.type)})),d().createElement("div",{className:"jp-FormGroup-description"},n.description),d().createElement("div",{className:"validationErrors"}))))),d().createElement("fieldset",null,d().createElement("legend",null,t.title),Object.entries(p).map((([e,t])=>d().createElement(v,{key:e,hash:e,property:t,removeProperty:S,setProperty:b}))),d().createElement("span",null,t.description)))))),d().createElement("div",{className:"jp-ArrayOperations"},d().createElement("button",{className:"jp-mod-styled jp-mod-reject",onClick:()=>{const t=l.UUID.uuid4(),n={...p,[t]:{property:"",type:"string",value:""}},r={};Object.values(n).forEach((e=>{r[e.property]=e.value})),e.updateSetting.invoke(e.serverHash,{[h]:r}).catch(console.error),g(n)}},e.trans.__("Add property")),d().createElement("button",{className:"jp-mod-styled jp-mod-warn jp-FormGroup-removeButton",onClick:()=>e.removeSetting(e.serverHash)},e.trans.__("Remove server"))))}function v(e){const[t,n]=(0,u.useState)({...e.property}),r=(r,a)=>{let s=r;"number"===a&&(s=parseFloat(r));const o={...t,value:s};e.setProperty.invoke(e.hash,o).catch(console.error),n(o)};return d().createElement("div",{key:e.hash,className:"form-group small-field"},d().createElement("div",{className:"jp-FormGroup-content jp-LSPExtension-FormGroup-content"},d().createElement("input",{className:"form-control",type:"text",required:!0,placeholder:"Property name",value:t.property,onChange:r=>{(r=>{const a={...t,property:r};e.setProperty.invoke(e.hash,a).catch(console.error),n(a)})(r.target.value)}}),d().createElement("select",{className:"form-control",value:t.type,onChange:r=>(r=>{let a;a="boolean"!==r&&("number"===r?0:"");const s={...t,type:r,value:a};n(s),e.setProperty.invoke(e.hash,s).catch(console.error)})(r.target.value)},d().createElement("option",{value:"string"},"String"),d().createElement("option",{value:"number"},"Number"),d().createElement("option",{value:"boolean"},"Boolean")),d().createElement("input",{className:"form-control",type:{string:"text",number:"number",boolean:"checkbox"}[t.type],required:!1,placeholder:"Property value",value:"boolean"!==t.type?t.value:void 0,checked:"boolean"===t.type?t.value:void 0,onChange:"boolean"!==t.type?e=>r(e.target.value,t.type):e=>r(e.target.checked,t.type)}),d().createElement("button",{className:"jp-mod-minimal jp-Button",onClick:()=>{e.removeProperty(e.hash)}},d().createElement(i.closeIcon.react,null))))}class f extends d().Component{constructor(e){super(e),this.removeSetting=e=>{if(e in this.state.items){const t={};for(const n in this.state.items)n!==e&&(t[n]=this.state.items[n]);this.setState((e=>({...e,items:t})),(()=>{this.saveServerSetting()}))}},this.updateSetting=(e,t)=>{if(e in this.state.items){const n={};for(const r in this.state.items)n[r]=r===e?{...this.state.items[r],...t}:this.state.items[r];this.setState((e=>({...e,items:n})),(()=>{this.saveServerSetting()}))}},this.addServerSetting=()=>{let e=0,t="newKey";for(;Object.values(this.state.items).map((e=>e.serverName)).includes(t);)e+=1,t=`newKey-${e}`;this.setState((e=>({...e,items:{...e.items,[l.UUID.uuid4()]:{...this._defaultSetting,serverName:t}}})),(()=>{this.saveServerSetting()}))},this.saveServerSetting=()=>{const e={};Object.values(this.state.items).forEach((t=>{const{serverName:n,...r}=t;e[n]=r})),this._setting.set(p,e).catch(console.error)},this._setting=e.formContext.settings,this._trans=e.translator.load("jupyterlab");const t=this._setting.schema.definitions;this._defaultSetting=t.languageServer.default,this._schema=t.languageServer.properties;const n=e.schema.title,r=e.schema.description,a=e.formContext.settings.get(p).composite;let s={};a&&Object.entries(a).forEach((([e,t])=>{if(t){const n=l.UUID.uuid4();s[n]={serverName:e,...t}}})),this.state={title:n,desc:r,items:s},this._debouncedUpdateSetting=new m.Debouncer(this.updateSetting.bind(this))}render(){return d().createElement("div",null,d().createElement("fieldset",null,d().createElement("legend",null,this.state.title),d().createElement("p",{className:"field-description"},this.state.desc),d().createElement("div",{className:"field field-array field-array-of-object"},Object.entries(this.state.items).map((([e,t],n)=>d().createElement(g,{key:`${n}-${e}`,trans:this._trans,removeSetting:this.removeSetting,updateSetting:this._debouncedUpdateSetting,serverHash:e,settings:t,schema:this._schema})))),d().createElement("div",null,d().createElement("button",{style:{margin:2},className:"jp-mod-styled jp-mod-reject",onClick:this.addServerSetting},this._trans.__("Add server")))))}}const E={activate:function(e,t,n,a,s){const o="languageServers",i=new r.LanguageServerManager({}),l=new r.DocumentConnectionManager({languageServerManager:i}),m=e=>{const t=e.composite,n=t.languageServers||{};if("on"!==t.activate||i.isEnabled){if("off"===t.activate&&i.isEnabled)return void i.disable()}else i.enable().catch(console.error);l.initialConfigurations=n,l.updateConfiguration(n),l.updateServerConfigurations(n),l.updateLogging(t.logAllCommunication,t.setTrace)};return t.transform(E.id,{fetch:e=>{const t=e.schema.properties,n={};return i.sessions.forEach(((e,t)=>{n[t]={rank:50,configuration:{}}})),t[o].default=n,e},compose:e=>{const t=e.schema.properties,n=e.data.user,r=t[o].default,a=n[o];let s={...r};a&&(s={...s,...a});const i={[o]:s};return Object.entries(t).forEach((([e,t])=>{e!==o&&(i[e]=e in n?n[e]:t.default)})),e.data.composite=i,e}}),i.sessionsChanged.connect((async()=>{await t.reload(E.id)})),t.load(E.id).then((e=>{m(e),e.changed.connect((()=>{m(e)})),i.disable()})).catch((e=>{console.error(e.message)})),a&&function(e,t,n){const r=n.load("jupyterlab"),a=new c.Signal(t);t.connected.connect((()=>a.emit(t))),t.disconnected.connect((()=>a.emit(t))),t.closed.connect((()=>a.emit(t))),t.documentsChanged.connect((()=>a.emit(t)));let s=[];e.add({name:r.__("Language servers"),running:()=>{const e=new Set([...t.connections.values()]);return s=[...e].map((e=>new b(e,t))),s},shutdownAll:()=>{s.forEach((e=>{e.shutdown()}))},refreshRunning:()=>{},runningChanged:a,shutdownLabel:r.__("Shut Down"),shutdownAllLabel:r.__("Shut Down All"),shutdownAllConfirmationText:r.__("Are you sure you want to permanently shut down all running language servers?")})}(a,l,n),s&&s.addRenderer(o,(e=>function(e,t){return d().createElement(f,{...e,translator:t})}(e,n))),l},id:"@jupyterlab/lsp-extension:plugin",requires:[s.ISettingRegistry,o.ITranslator],optional:[a.IRunningSessionManagers,i.IFormComponentRegistry],provides:r.ILSPDocumentConnectionManager,autoStart:!0},y={id:"@jupyterlab/lsp-extension:feature",activate:()=>new r.FeatureManager,provides:r.ILSPFeatureManager,autoStart:!0},S={id:r.ILSPCodeExtractorsManager.name,activate:e=>{const t=new r.CodeExtractorsManager,n=new r.TextForeignCodeExtractor({language:"markdown",isStandalone:!1,file_extension:"md",cellType:["markdown"]});t.register(n,null);const a=new r.TextForeignCodeExtractor({language:"text",isStandalone:!1,file_extension:"txt",cellType:["raw"]});return t.register(a,null),t},provides:r.ILSPCodeExtractorsManager,autoStart:!0};class b{constructor(e,t){this._connection=new WeakSet([e]),this._manager=t,this._serverIdentifier=e.serverIdentifier,this._serverLanguage=e.serverLanguage}open(){}icon(){return i.pythonIcon}label(){var e,t;return`${null!==(e=this._serverIdentifier)&&void 0!==e?e:""} (${null!==(t=this._serverLanguage)&&void 0!==t?t:""})`}shutdown(){for(const[e,t]of this._manager.connections.entries())if(this._connection.has(t)){const t=this._manager.documents.get(e);this._manager.unregisterDocument(t)}this._manager.disconnect(this._serverIdentifier)}}const _=[E,y,S]}}]);