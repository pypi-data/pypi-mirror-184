(self.webpackChunk_hadim_jupyter_archive=self.webpackChunk_hadim_jupyter_archive||[]).push([[261],{261:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var o=r(740),a=r(15),n=r(600),c=r(813),i=r(305),s=r(191),d=r(918),l=r(992),h=r(544);const m=new h.LabIcon({name:"jupyter-archive:archive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="black" d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></svg>'}),u=new h.LabIcon({name:"jupyter-archive:unarchive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="black" d="M20.55 5.22l-1.39-1.68A1.51 1.51 0 0018 3H6c-.47 0-.88.21-1.15.55L3.46 5.22C3.17 5.57 3 6.01 3 6.5V19a2 2 0 002 2h14c1.1 0 2-.9 2-2V6.5c0-.49-.17-.93-.45-1.28zM12 9.5l5.5 5.5H14v2h-4v-2H6.5L12 9.5zM5.12 5l.82-1h12l.93 1H5.12z"/></svg>'});var p;function v(e,t,r,o){const n=i.ServerConnection.makeSettings().baseUrl;let c=a.URLExt.join(n,"directories",a.URLExt.encodeParts(e));""===e&&(c+="/");const s=new URL(c),d=()=>Math.random().toString(36).substr(2);s.searchParams.append("archiveToken",(20,(d()+d()+d()+d()).substr(0,20))),s.searchParams.append("archiveFormat",t),s.searchParams.append("followSymlinks",r),s.searchParams.append("downloadHidden",o);const l=document.cookie.match("\\b_xsrf=([^;]*)\\b");l&&s.searchParams.append("_xsrf",l[1]),c=s.toString();const h=window.chrome;if(h&&(h.webstore||h.runtime))window.open(c);else{const e=document.createElement("a");document.body.appendChild(e),e.setAttribute("href",c),e.setAttribute("download",""),e.click(),document.body.removeChild(e)}}!function(e){e.downloadArchive="filebrowser:download-archive",e.extractArchive="filebrowser:extract-archive",e.downloadArchiveCurrentFolder="filebrowser:download-archive-current-folder"}(p||(p={}));const w={id:"@hadim/jupyter-archive:archive",autoStart:!0,requires:[c.IFileBrowserFactory,n.ISettingRegistry],optional:[s.ITranslator],activate:(e,t,r,n)=>{const c=(null!=n?n:s.nullTranslator).load("jupyter_archive");console.log("JupyterLab extension jupyter-archive is activated!");const{commands:h}=e,{tracker:w}=t,f=[".zip",".tgz",".tar.gz",".tbz",".tbz2",".tar.bz",".tar.bz2",".txz",".tar.xz"];let g,x,b;const _=".jp-DirListing-content",k='.jp-DirListing-item[data-isdir="true"]',C=new l.Menu({commands:h});C.title.label=c.__("Download As"),C.title.icon=m;const y=new l.Menu({commands:h});let z,A;function L(t,r){t!==r&&(null!==t&&null!=r||(void 0!==r&&(z.dispose(),A.dispose()),null===t?(z=e.contextMenu.addItem({selector:k,rank:10,type:"submenu",submenu:C}),A=e.contextMenu.addItem({selector:_,rank:3,type:"submenu",submenu:y})):(z=e.contextMenu.addItem({command:p.downloadArchive,selector:k,rank:10}),A=e.contextMenu.addItem({command:p.downloadArchiveCurrentFolder,selector:_,rank:3}))),g=t)}y.title.label=c.__("Download Current Folder As"),y.title.icon=m,["zip","tar.bz2","tar.gz","tar.xz"].forEach((e=>{C.addItem({command:p.downloadArchive,args:{format:e}}),y.addItem({command:p.downloadArchiveCurrentFolder,args:{format:e}})})),r.load("@hadim/jupyter-archive:archive").then((e=>{e.changed.connect((e=>{L(e.get("format").composite,g),x=e.get("followSymlinks").composite,b=e.get("downloadHidden").composite})),L(e.get("format").composite,g),x=e.get("followSymlinks").composite,b=e.get("downloadHidden").composite})).catch((e=>{console.error(e),(0,o.showErrorMessage)("Fail to read settings for '@hadim/jupyter-archive:archive'",e)})),h.addCommand(p.downloadArchive,{execute:e=>{const t=w.currentWidget;t&&(0,d.each)(t.selectedItems(),(t=>{if("directory"===t.type){const r=e.format;v(t.path,f.indexOf("."+r)>=0?r:g,x,b)}}))},icon:e=>"format"in e?"":m,label:e=>{const t=(e.format||"").replace("."," ").toLocaleUpperCase();return t?c.__("%1 Archive",t):c.__("Download as an Archive")}}),h.addCommand(p.extractArchive,{execute:()=>{const e=w.currentWidget;e&&(0,d.each)(e.selectedItems(),(e=>{!function(e){const t=i.ServerConnection.makeSettings(),r=t.baseUrl;let n=a.URLExt.join(r,"extract-archive",a.URLExt.encodeParts(e));const c=new URL(n),s=document.cookie.match("\\b_xsrf=([^;]*)\\b");s&&c.searchParams.append("_xsrf",s[1]),n=c.toString(),i.ServerConnection.makeRequest(n,{method:"GET"},t).then((e=>{200!==e.status&&e.json().then((t=>{throw(0,o.showErrorMessage)("Fail to extract the archive file",t.reason),new i.ServerConnection.ResponseError(e)}))}))}(e.path)}))},icon:u,isVisible:()=>{const e=w.currentWidget;let t=!1;if(e){const r=e.selectedItems().next();if(r){const e=a.PathExt.basename(r.path),o=e.split(".");let n="";o.length>=2&&(n="."+o.splice(o.length-2,2).join(".")),t=f.indexOf(a.PathExt.extname(e))>=0||f.indexOf(n)>=0}}return t},label:c.__("Extract Archive")}),e.contextMenu.addItem({command:p.extractArchive,selector:'.jp-DirListing-item[data-isdir="false"]',rank:10}),h.addCommand(p.downloadArchiveCurrentFolder,{execute:e=>{const t=w.currentWidget;if(t){const r=e.format;v(t.model.path,f.indexOf("."+r)>=0?r:g,x,b)}},icon:e=>"format"in e?"":m,label:e=>{const t=(e.format||"").replace("."," ").toLocaleUpperCase();return t?c.__("%1 Archive",t):c.__("Download Current Folder as an Archive")}})}}}}]);