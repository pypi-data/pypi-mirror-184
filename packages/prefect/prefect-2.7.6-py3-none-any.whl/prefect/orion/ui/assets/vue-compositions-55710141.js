import{j as q,i as h,v as g,af as M,s as w,ag as T,ah as D,k as K,t as j,ai as _,x as U,y as z,aj as F,u as y}from"./index-4d9fe32c-718dc5d9.js";var G=Object.defineProperty,L=(s,e,t)=>e in s?G(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,i=(s,e,t)=>(L(s,typeof e!="symbol"?e+"":e,t),t);function I(s){const e=eval;try{return e(s),!0}catch{return!1}}var v=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},B=typeof v=="object"&&v&&v.Object===Object&&v,H=typeof self=="object"&&self&&self.Object===Object&&self;B||H||Function("return this")();function ne(s,e=!0){const t=T();return q(()=>{let r=t.params[s];return e&&Array.isArray(r)&&r.length&&([r]=r),r})}function Q(s,e){return JSON.stringify(s)===JSON.stringify(e)}function ie(s,e=""){var t;const r=D(),n=T(),u=R(e,(t=p(n,s))!=null?t:e),a=h(u),o=g(a,(l,f)=>{Q(l,f)||r.push({query:{...n.query,[s]:a.value}})}),c=g(n,(l,f)=>{var d,O;const P=(d=p(l,s))!=null?d:e,$=(O=p(f,s))!=null?O:e,S=R($,P);S!==a.value&&(a.value=S)},{deep:!0});return M(()=>{o(),c()}),a}function p({query:s},e){return s[e]}function R(s,e){return Array.isArray(s)&&!Array.isArray(e)?[e]:typeof s=="string"&&Array.isArray(e)?e[0]:e}class V{constructor(e){i(this,"type"),this.type=e}get length(){const e=this.storage();return e?e.length:0}get(e,t=null){const r=this.storage();if(!r)return null;const n=r.getItem(e);if(n===null)return t;try{return JSON.parse(n)}catch{return console.error(`Unable to parse current value for key ${e}, returning default instead`),t}}set(e,t){const r=JSON.stringify(t),n=this.storage();if(n)return n.setItem(e,r)}remove(e){const t=this.storage();if(t)return t.removeItem(e)}clear(){const e=this.storage();if(e)return e.clear()}key(e){const t=this.storage();return t?t.key(e):null}storage(){return this.type==="local"&&I("localStorage")?localStorage:this.type==="session"&&I("sessionStorage")?sessionStorage:null}}function W(s,e,t=null){const r=new V(s),n=r.get(e,t),u=h(n);let a=!1;const o=()=>{a=!0,r.remove(e),u.value=null},c=l=>{u.value=l};return K(()=>{if(a){console.warn(`Storage for key ${e} as been removed and cannot be updated`);return}r.set(e,u.value)}),{value:u,initialValue:n,remove:o,set:c}}function oe(s,e=null){return W("local",s,e)}function ue(s){const e=Reflect.ownKeys(Object.prototype),t={};let r=Reflect.getPrototypeOf(s);for(Reflect.ownKeys(s).forEach(n=>{typeof n=="string"&&typeof s[n]=="function"&&(t[n]=s[n].bind(s))});r&&r!==Object.prototype;)Reflect.ownKeys(r).forEach(n=>{typeof n=="string"&&typeof t[n]>"u"&&typeof s[n]=="function"&&!e.includes(n)&&(t[n]=r[n].bind(s))}),r=Reflect.getPrototypeOf(r);return t}function C(s){return y(s).map(y)}function X(s){return j(s)||_(s)?s:Array.isArray(s)?s.filter(e=>j(e)||_(e)):null}function m(s){const{loading:e,error:t,errored:r,response:n,executed:u}=s;return{loading:e,error:t,errored:r,response:n,executed:u,refresh:()=>s.refresh(),unsubscribe:()=>s.unsubscribe(),isSubscribed:()=>s.isSubscribed(),promise:()=>s.promise().then(a=>w(m(a)))}}const E=class{static get(){return E.id++}};let J=E;i(J,"id",0);class Y{constructor(e,t){i(this,"id"),i(this,"options"),i(this,"loading",h(!1)),i(this,"response",h(void 0)),i(this,"errored",h(!1)),i(this,"error",h(null)),i(this,"executed",h(!1)),i(this,"channel"),this.id=J.get(),this.channel=e,this.options=t,this.loading.value=e.loading,this.response.value=e.response,this.errored.value=e.errored,this.error.value=e.error,this.executed.value=e.executed}async refresh(){await this.channel.execute()}unsubscribe(){this.channel.unsubscribe(this.id)}isSubscribed(){return this.channel.isSubscribed(this.id)}promise(){return new Promise((e,t)=>{if(this.executed.value){if(this.errored.value){t(this.error.value);return}e(this);return}const r=g(this.executed,()=>{this.executed.value&&(n(),r(),e(this))}),n=g(this.errored,()=>{this.errored.value&&(r(),n(),t(this.error.value))})})}}const b=class{static get(s,e){let t;b.actionIds.has(s)?t=b.actionIds.get(s):(t=b.actionId++,b.actionIds.set(s,t));const r=C(e),n=JSON.stringify(r);return`${t}-${n}`}};let x=b;i(x,"actionId",0),i(x,"actionIds",new Map);class Z{constructor(e,t,r){i(this,"signature"),i(this,"manager"),i(this,"action"),i(this,"args"),i(this,"subscriptions",new Map),i(this,"timer",null),i(this,"lastExecution",0),i(this,"_loading",!1),i(this,"_executed",!1),i(this,"_errored",!1),i(this,"_error",null),i(this,"_response"),this.signature=x.get(t,r),this.manager=e,this.action=t,this.args=r}get interval(){const e=Array.from(this.subscriptions.values()).map(t=>{var r;return(r=t.options.interval)!=null?r:1/0});return Math.min(...e)}get response(){return this._response}set response(e){this._response=e;for(const t of this.subscriptions.values())t.response.value=e}get executed(){return this._executed}set executed(e){this._executed=e;for(const t of this.subscriptions.values())t.executed.value=e}get loading(){return this._loading}set loading(e){this._loading=e;for(const t of this.subscriptions.values())t.loading.value=e}get errored(){return this._errored}set errored(e){this._errored=e;for(const t of this.subscriptions.values())t.errored.value=e}get error(){return this._error}set error(e){this._error=e;for(const t of this.subscriptions.values())t.error.value=e}subscribe(e){const t=new Y(this,e);return this.subscriptions.set(t.id,t),this.executed||this.loading?t.executed.value=this.executed:this.execute(),this.setInterval(),t}unsubscribe(e){this.subscriptions.delete(e),this.setInterval(),this.subscriptions.size==0&&this.manager.deleteChannel(this.signature)}async execute(){const e=C(this.args);this.loading=!0,this.lastExecution=Date.now(),this.setInterval();try{this.response=await this.action(...e),this.errored=!1,this.error=null}catch(t){this.errored=!0,this.error=t,this.clearTimer(),console.error(t)}finally{this.executed=!0,this.loading=!1}}isSubscribed(e){return this.subscriptions.has(e)}clearTimer(){this.timer&&clearTimeout(this.timer)}setInterval(){if(this.clearTimer(),this.interval===1/0||this.errored)return;const e=Date.now()-this.lastExecution,t=this.interval-e;this.timer=setTimeout(()=>this.execute(),t)}}class ee{constructor(){i(this,"channels",new Map)}subscribe(e,t,r){return this.getChannel(e,t).subscribe(r)}deleteChannel(e){this.channels.delete(e)}getChannel(e,t){const r=new Z(this,e,t);return this.channels.has(r.signature)?this.channels.get(r.signature):(this.channels.set(r.signature,r),r)}}const te=new ee;function k(...[s,e,t={}]){var r;const n=(r=t.manager)!=null?r:te,u=e??[],a=n.subscribe(s,u,t),o=w(m(a));let c;const l=X(u);return l!==null&&(c=g(l,()=>{var f;if(!o.isSubscribed()||y(u)===null){c();return}o.unsubscribe();const d=n.subscribe(s,u,t);(f=d.response).value!=null||(f.value=o.response),d.executed.value=d.executed.value||o.executed,Object.assign(o,m(d))},{deep:!0})),U()&&z(()=>{o.unsubscribe(),c&&c()}),o}const se=()=>{};function A(){const s=N(k(se));return s.executed=h(!1),s}function N(s){return F(s)}function ae(...[s,e,t={}]){const r=w(A());return g(e,(n,u)=>{var a;if(n===null&&u===void 0)return;if(r.isSubscribed()&&r.unsubscribe(),n===null){Object.assign(r,A());return}const o=N(k(s,e,t));(a=o.response).value!=null||(a.value=r.response),o.executed.value=o.executed.value||r.executed,Object.assign(r,o)},{immediate:!0}),r}export{ie as a,k as c,ue as d,oe as f,ne as u,ae as v};
